<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>115å¹´æ¡ƒåœ’å¸‚å‹•ç‰©ä¿è­·è™•-å°¾ç‰™å¤§å¯Œç¿</title>
    <style>
        :root {
            --primary-blue: #01579B;
            --accent-orange: #FF8C00;
            --bg-gradient: linear-gradient(180deg, #E1F5FE 0%, #B3E5FC 50%, #81D4FA 100%);
        }

        /* è‡ªå®šç¾©æ»‘é¼ æ¨£å¼ï¼šæ”¹ç‚ºè‚‰çƒ */
        * { 
            box-sizing: border-box; 
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><path fill='%23795548' d='M8.5,8.5c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S7.4,8.5,8.5,8.5z M15.5,8.5c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2 S14.4,8.5,15.5,8.5z M4.5,13c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S3.4,13,4.5,13z M19.5,13c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2 S18.4,13,19.5,13z M12,20c2.2,0,4-1.8,4-4c0-1.1-0.9-2-2-2s-2,0.9-2,2s-0.9,2-2,2s-2-0.9-2-2s-0.9-2-2-2s-2,0.9-2,2 C8,18.2,9.8,20,12,20z'/></svg>") 16 16, auto;
        }

        /* æŒ‰éˆ•èˆ‡å¯é»æ“Šç‰©ä»¶çš„æ»‘é¼ æ¨£å¼ï¼šæ”¾å¤§ç‰ˆè‚‰çƒ */
        button, .cell, input {
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 24 24'><path fill='%23FF8C00' d='M8.5,8.5c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S7.4,8.5,8.5,8.5z M15.5,8.5c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2 S14.4,8.5,15.5,8.5z M4.5,13c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S3.4,13,4.5,13z M19.5,13c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2 S18.4,13,19.5,13z M12,20c2.2,0,4-1.8,4-4c0-1.1-0.9-2-2-2s-2,0.9-2,2s-0.9,2-2,2s-2-0.9-2-2s-0.9-2-2-2s-2,0.9-2,2 C8,18.2,9.8,20,12,20z'/></svg>") 20 20, pointer !important;
        }

        /* å¼·åŒ–ç‰ˆï¼šé»æ“Šç²’å­ç‰¹æ•ˆæ¨£å¼ */
        .click-particle {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 45px; /* å¢å¤§åŸºç¤å°ºå¯¸ */
            text-shadow: 0 0 10px rgba(255,255,255,0.8), 2px 2px 5px rgba(0,0,0,0.3); /* å¢åŠ ç™¼å…‰èˆ‡é™°å½± */
            animation: particleFade 0.8s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
        }

        @keyframes particleFade {
            0% { 
                transform: translate(-50%, -50%) scale(0.3) rotate(0deg); 
                opacity: 0; 
            }
            20% {
                opacity: 1;
            }
            100% { 
                /* æœ€çµ‚æ”¾å¤§åˆ° 2.5 å€ä¸¦å‘ä¸Šå™´ç™¼ */
                transform: translate(-50%, -200%) scale(2.5) rotate(30deg); 
                opacity: 0; 
            }
        }

        body {
            margin: 0; padding: 0;
            font-family: "Microsoft JhengHei", sans-serif;
            background: var(--bg-gradient);
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        #setup-page, #name-page { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .title { font-size: clamp(36px, 6vw, 80px); font-weight: bold; color: var(--primary-blue); margin-bottom: 25px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .circle-btn { width: 110px; height: 110px; border-radius: 50%; border: 6px solid var(--primary-blue); background: white; font-size: 42px; font-weight: bold; color: var(--primary-blue); transition: 0.2s; }
        .circle-btn:hover { background: var(--primary-blue); color: white; transform: scale(1.1); }
        .input-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; max-height: 50vh; overflow-y: auto; padding: 10px; }
        input { padding: 15px; font-size: 24px; border-radius: 12px; border: 3px solid var(--primary-blue); text-align: center; width: 100%; }
        .start-game-btn { padding: 18px 70px; font-size: 32px; background: #2E7D32; color: white; border-radius: 50px; border: none; font-weight: bold; }

        #game-page { display: none; flex-direction: column; height: 100vh; padding: 8px; }
        
        .board-container { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            grid-template-rows: repeat(5, 1fr); 
            gap: 6px; 
            flex: 1; 
            min-height: 0; 
        }
        
        .cell { 
            background: white; border: 3.5px solid #333; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: clamp(14px, 1.5vw, 24px);
            padding: 5px; text-align: center; line-height: 1.2;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.2); position: relative; 
            overflow: visible; 
            transition: transform 0.1s, filter 0.1s;
            z-index: 2;
        }

        .cell:hover { filter: brightness(0.9); transform: scale(1.02); z-index: 5; }

        .center-area { 
            grid-column: 2 / 7; grid-row: 2 / 5;
            background-image: url('https://raw.githubusercontent.com/JY-Chiu/html/refs/heads/main/bg.jpg'); 
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            border: 6px solid var(--primary-blue); border-radius: 20px; 
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            margin: 2px; padding-bottom: 20px;
            z-index: 1; position: relative;
            overflow: hidden;
        }

        .bottom-left-logo {
            position: absolute; bottom: 15px; left: 15px;
            width: clamp(100px, 18vw, 380px); height: auto;
            border-radius: 10px; pointer-events: none;
            opacity: 0.9;
        }

        #info-box { 
            font-size: clamp(18px, 2vw, 30px); 
            background: rgba(0, 0, 0, 0.75); 
            color: #FFEB3B; 
            padding: 8px 35px; border-radius: 40px; border: 2.5px solid #FFD700; 
            text-align: center; min-width: 220px; max-width: 90%; margin: 0 auto;
            backdrop-filter: blur(5px); box-shadow: 0 6px 15px rgba(0,0,0,0.4); white-space: nowrap;
            z-index: 10;
        }

        .marker-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-wrap: wrap; align-content: space-between; justify-content: space-between; padding: 3px; pointer-events: none; overflow: visible; }
        .player-marker { font-size: clamp(22px, 2.8vw, 44px); filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.4)); z-index: 10; transition: all 0.3s; }
        .player-marker.selected { animation: markerPulse 0.8s infinite alternate cubic-bezier(0.4, 0, 0.6, 1); z-index: 999; filter: drop-shadow(0 0 10px rgba(255, 235, 59, 0.8)); }
        @keyframes markerPulse { from { transform: scale(1.1) translateY(0); } to { transform: scale(1.8) translateY(-10px); } }

        .controls { display: flex; align-items: center; background: white; padding: 12px; border-top: 5px solid var(--primary-blue); gap: 15px; z-index: 100; }
        .player-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; flex: 1; }
        .player-btn { flex: 0 0 auto; padding: 8px 15px; border: 3.5px solid #ddd; border-radius: 12px; background: white; text-align: center; min-width: 100px; }
        .player-btn.active { border-color: var(--accent-orange); background: #FFF3E0; }
        .player-btn.lucky { border-color: #f44336; animation: luckyPulse 2s infinite; }
        .player-btn .icon { font-size: 32px; display: block; }
        .player-btn .name { font-size: 18px; font-weight: bold; white-space: nowrap; }
        .dice-group { display: flex; gap: 8px; }
        .dice-btn { width: 60px; height: 60px; background: #FF5722; color: white; border: none; border-radius: 12px; font-size: 32px; font-weight: bold; box-shadow: 0 5px 0 #BF360C; }
        .dice-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #BF360C; }

        #card-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; }
        .card { width: 750px; padding: 40px; border-radius: 40px; text-align: center; border: 10px solid gold; animation: cardPop 0.4s ease-out; }
        .card.chance { background: linear-gradient(135deg, #FF9800, #E65100); color: white; }
        .card.destiny { background: linear-gradient(135deg, #9C27B0, #4A148C); color: white; }
        .card.special { background: linear-gradient(135deg, #2196F3, #1565C0); color: white; border-color: #E3F2FD; }
        .card h1 { font-size: 72px; margin-bottom: 20px; }
        .opt-container { display: flex; justify-content: center; gap: 20px; margin-top: 20px; width: 100%; }
        .pk-btn { flex: 1; max-width: 320px; padding: 25px; font-size: 38px; border-radius: 20px; font-weight: bold; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.3); white-space: nowrap; }
        .pk-win { background: #4CAF50; color: white; }
        .pk-lose { background: #F44336; color: white; }
        @keyframes cardPop { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes luckyPulse { 0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); } }
    </style>
</head>
<body>
    <div id="setup-page">
        <div class="title">ğŸ¾ 115å¹´æ¡ƒåœ’å¸‚å‹•ç‰©ä¿è­·è™• ğŸ¾<br>å°¾ç‰™å¤§å¯Œç¿</div>
        <div class="grid-container" id="count-btns"></div>
    </div>

    <div id="name-page" style="display: none;">
        <div class="title">ç¢ºèªå„çµ„åç¨±</div>
        <div class="input-grid" id="input-fields"></div>
        <button class="start-game-btn" onclick="initGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="game-page">
        <div class="board-container" id="board">
            <div class="center-area">
                <img src="logo.jpg" class="bottom-left-logo" alt="Logo">
                <div id="info-box">ğŸ² è«‹æ“²éª°å­</div>
            </div>
        </div>
        <div class="controls">
            <div class="player-tabs" id="player-tabs"></div>
            <div class="dice-group" id="dice-group"></div>
        </div>
    </div>

    <div id="card-overlay">
        <div id="card-content" class="card">
            <h1 id="card-title">æ¨™é¡Œ</h1>
            <div id="card-body">
                <h2 id="card-desc" style="font-size: 42px;">å…§å®¹æè¿°</h2>
                <div class="opt-container" id="opt-list"></div>
            </div>
        </div>
    </div>

    <script>
        // --- æ»‘é¼ é»æ“Šç‰¹æ•ˆ ---
        const emojis = ["ğŸ¦´", "â¤ï¸", "ğŸ¾", "ğŸ¶", "ğŸ±", "âœ¨", "ğŸ–"];
        document.addEventListener('mousedown', (e) => {
            const particle = document.createElement('div');
            particle.className = 'click-particle';
            particle.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            particle.style.left = e.clientX + 'px';
            particle.style.top = e.clientY + 'px';
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 800);
        });

        // --- éŠæˆ²é‚è¼¯ ---
        const BOARD_PATH_COORDS = [
            [1,1],[1,2],[1,3],[1,4],[1,5],[1,6],[1,7], 
            [2,7],[3,7],[4,7],                         
            [5,7],[5,6],[5,5],[5,4],[5,3],[5,2],[5,1], 
            [4,1],[3,1],[2,1]                          
        ];
        
        const CELL_THEMES = [
            ["ğŸ <br>å‹•ä¿è™•ç¸½éƒ¨", "#FFA600"], 
            ["ğŸš€<br>æ•‘æ´å‡ºå‹¤<br>å†éª°ä¸€æ¬¡", "#FDDE95"], 
            ["ğŸ“¢<br>èªé¤Šæ¨å»£<br>å–Šå‰ç¥¥è©±", "#FDDE95"], 
            ["ğŸ“¸<br>çµ•è‚²å®£å°<br>èˆ‡ä»»ä¸€é•·å®˜æ¯”å¿ƒåˆç…§", "#FDDE95"], 
            ["ğŸ•<br>æ¯›å­©æ‰¾åˆ°å®¶<br>å‰é€² 1 æ ¼", "#A1F999"], 
            ["ğŸ¥‚<br>æ„Ÿè¬å¿—å·¥<br>æ•¬é•·å®˜æ¡Œä¸€æ¯", "#FDDE95"], 
            ["â“<br>é ˜é¤Šä¿¡ä»¶<br>(æ©Ÿæœƒ)", "#FF8C00"],       
            ["ğŸš‘<br>æ”¯æ´å‰ç·š<br>ä¸‹å›é•·å®˜ä»£éª°", "#FDDE95"], 
            ["ğŸ’©<br>è¸©åˆ°é»ƒé‡‘<br>å¾Œé€€ 1 æ ¼", "#FD9E95"], 
            ["ğŸ”™<br>å…¬æ–‡é€€ä»¶<br>å›åˆ°èµ·é»", "#FF5252"],
            ["ğŸ’¤<br>æ¯›å­©åˆç¡å€<br>(ä¼‘æ¯ä¸€å›åˆ)", "#FF8C00"], 
            ["ğŸµ<br>æ³¨å°„è£œçµ¦<br>é£²å“ä¸€ç½", "#FDDE95"],
            ["ğŸš§<br>æ•çŠ¬ç¶²ç ´æ´<br>å¾Œé€€ 2 æ ¼", "#FD9E95"], 
            ["ğŸ¤³<br>å‹•ä¿å°å¤©ä½¿<br>èˆ‡ä»»ä¸€é•·å®˜æ¯”å¿ƒåˆç…§", "#FDDE95"], 
            ["âš”ï¸<br>èŒå¯µæ‰è—æˆ°<br>(PKå¤§è³½)", "#FDDE95"], 
            ["ğŸ¦´<br>åŠ èœç½ç½<br>é›¶é£Ÿä¸€åŒ…", "#FDDE95"], 
            ["ğŸŒŸ<br>æ³•è¦è€ƒé©—<br>(å‘½é‹)", "#FF8C00"],       
            ["ğŸŒ§ï¸<br>æ•çŠ¬é‡é›¨<br>å¾Œé€€ 1 æ ¼", "#FD9E95"],
            ["ğŸ’‰<br>ç–«è‹—æ–½æ‰“<br>å‰é€² 1 æ ¼", "#A1F999"], 
            ["ğŸ¤<br>æµªæ„›å‚³å”±<br>ç¾å ´åˆå”±ä¸€é¦–æ­Œ", "#FDDE95"]
        ];

        const REWARDS = {"â“ é ˜é¤Šä¿¡ä»¶ (æ©Ÿæœƒ)": ["100å…ƒç¦®åˆ¸", "éé…’ç²¾é£²æ–™", "ç¾å ´åˆå”±", "ä¸»ç®¡åŠ ç¢¼"],"ğŸŒŸ æ³•è¦è€ƒé©— (å‘½é‹)": ["100å…ƒç¦®åˆ¸", "åŠ èœé›¶é£ŸåŒ…", "æµªæ„›å‚³å”±", "å†ä¾†ä¸€æ¬¡"]};
        const PLAYER_ICONS = ["ğŸ¶","ğŸ±","ğŸ­","ğŸ°","ğŸ¦Š","ğŸ¼","ğŸ¨","ğŸ¯"];
        let players = [], positions = [], luckyStatus = [], currentPlayerIdx = 0, isMoving = false;

        for(let i=1; i<=8; i++) {
            const btn = document.createElement('button');
            btn.className = 'circle-btn'; btn.innerText = i;
            btn.onclick = () => {
                document.getElementById('setup-page').style.display = 'none';
                document.getElementById('name-page').style.display = 'flex';
                const container = document.getElementById('input-fields');
                container.innerHTML = '';
                for(let j=0; j<i; j++) {
                    const input = document.createElement('input');
                    input.value = `${j+1} èª²`; input.className = 'player-name-input';
                    container.appendChild(input);
                }
            };
            document.getElementById('count-btns').appendChild(btn);
        }

        function initGame() {
            players = Array.from(document.querySelectorAll('.player-name-input')).map(inp => inp.value);
            positions = new Array(players.length).fill(0);
            luckyStatus = new Array(players.length).fill(false);
            document.getElementById('name-page').style.display = 'none';
            document.getElementById('game-page').style.display = 'flex';
            const board = document.getElementById('board');
            const centerArea = document.querySelector('.center-area');
            board.innerHTML = ''; board.appendChild(centerArea);
            
            BOARD_PATH_COORDS.forEach((coord, i) => {
                const cell = document.createElement('div');
                cell.className = 'cell'; cell.id = `cell-${i}`;
                cell.style.gridRow = coord[0]; cell.style.gridColumn = coord[1];
                cell.style.backgroundColor = CELL_THEMES[i][1];
                cell.onclick = () => { if(!isMoving) teleportTo(i); };
                cell.innerHTML = `<span>${CELL_THEMES[i][0]}</span><div class="marker-container" id="m-${i}"></div>`;
                board.appendChild(cell);
            });

            const tabBox = document.getElementById('player-tabs');
            players.forEach((name, i) => {
                const btn = document.createElement('button');
                btn.className = 'player-btn'; btn.id = `p-btn-${i}`;
                btn.innerHTML = `<span class="icon">${PLAYER_ICONS[i]}</span><span class="name">${name}</span>`;
                btn.onclick = () => selectPlayer(i);
                tabBox.appendChild(btn);
            });
            for(let i=1; i<=6; i++) {
                const btn = document.createElement('button');
                btn.className = 'dice-btn'; btn.innerText = i;
                btn.onclick = () => rollDice(i);
                document.getElementById('dice-group').appendChild(btn);
            }
            updateBoard(); selectPlayer(0);
        }

        function teleportTo(targetIndex) {
            if (isMoving) return;
            const cellText = CELL_THEMES[targetIndex][0].replace(/<br>/g, ' ');
            if (confirm(`æ‰‹å‹•ç§»å‹•ï¼šç¢ºå®šå°‡ã€${players[currentPlayerIdx]}ã€‘ç§»å‹•åˆ°ã€${cellText}ã€‘å—ï¼Ÿ`)) {
                isMoving = true;
                positions[currentPlayerIdx] = targetIndex;
                updateBoard();
                document.getElementById('info-box').innerText = `âš¡ è·³è½‰è‡³ï¼š${cellText}`;
                setTimeout(() => { handleLand(); }, 400);
            }
        }

        function selectPlayer(idx) { 
            if(!isMoving) { 
                currentPlayerIdx = idx; 
                document.querySelectorAll('.player-btn').forEach((b,i) => { b.classList.toggle('active', i==idx); });
                let msg = `è¼ªåˆ°ï¼š${PLAYER_ICONS[idx]} ${players[idx]}`;
                if(luckyStatus[idx]) msg += " (ğŸ“¢ å–Šå‰ç¥¥è©±!)";
                document.getElementById('info-box').innerText = msg; 
                document.getElementById(`p-btn-${idx}`).scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                updateBoard();
            } 
        }

        async function rollDice(steps) {
            if(isMoving) return; isMoving = true;
            document.getElementById('info-box').innerText = `ğŸ² éª°å‡ºï¼š${steps} æ­¥ï¼`;
            await new Promise(r => setTimeout(r, 600));
            for(let i=0; i<steps; i++) { 
                positions[currentPlayerIdx] = (positions[currentPlayerIdx] + 1) % 20;
                updateBoard(); 
                if (positions[currentPlayerIdx] === 0) { document.getElementById('info-box').innerText = `ğŸ æŠµé”çµ‚é»ï¼`; break; }
                await new Promise(r => setTimeout(r, 250)); 
            }
            handleLand();
        }

        function handleLand() {
            const pos = positions[currentPlayerIdx];
            const type = CELL_THEMES[pos][0].replace(/<br>/g, ' ');
            const infoBox = document.getElementById('info-box');
            infoBox.innerText = `${PLAYER_ICONS[currentPlayerIdx]} æŠµé”ï¼š${type}`;
            const overlay = document.getElementById('card-overlay');
            const card = document.getElementById('card-content');
            const title = document.getElementById('card-title');
            const desc = document.getElementById('card-desc');
            const optList = document.getElementById('opt-list');
            optList.innerHTML = ''; overlay.style.display = 'flex';

            if(type.includes("æ©Ÿæœƒ") || type.includes("å‘½é‹")) {
                const isChance = type.includes("æ©Ÿæœƒ");
                const cleanType = isChance ? "â“ é ˜é¤Šä¿¡ä»¶ (æ©Ÿæœƒ)" : "ğŸŒŸ æ³•è¦è€ƒé©— (å‘½é‹)";
                card.className = `card ${isChance ? "chance" : "destiny"}`;
                title.innerText = cleanType; desc.innerText = "è«‹é¸æ“‡çå‹µï¼š";
                REWARDS[cleanType].forEach(reward => {
                    const btn = document.createElement('button');
                    btn.className = "pk-btn pk-win"; btn.style.maxWidth = "100%"; btn.innerText = reward;
                    btn.onclick = () => { overlay.style.display = 'none'; isMoving = false; };
                    optList.appendChild(btn);
                });
            } else if(type.includes("èªé¤Šæ¨å»£")) {
                card.className = "card special"; title.innerText = "ğŸ“¢ å®£å°æ™‚é–“";
                desc.innerText = `ç‚ºäº†å¢åŠ èªé¤Šç‡ï¼Œ${players[currentPlayerIdx]} ä¹‹å¾Œæ“²éª°å‰éƒ½è¦å¤§å–Šå‰ç¥¥è©±ï¼`;
                luckyStatus[currentPlayerIdx] = true;
                document.getElementById(`p-btn-${currentPlayerIdx}`).classList.add('lucky');
                const btn = document.createElement('button');
                btn.className = "pk-btn pk-win"; btn.style.maxWidth = "100%"; btn.innerText = "èªé¤Šä¸æ£„é¤Šï¼";
                btn.onclick = () => { overlay.style.display = 'none'; isMoving = false; };
                optList.appendChild(btn);
            } else if(type.includes("PKå¤§è³½")) {
                card.className = "card special"; title.innerText = "âš”ï¸ èŒå¯µæ‰è—æˆ°"; desc.innerText = "æ‰¾ä¸€çµ„å°æ‰‹PKï¼Œè´å®¶å‰é€²ï¼";
                const winBtn = document.createElement('button'); winBtn.className = "pk-win pk-btn"; winBtn.innerText = "æˆ‘è´äº† (+1æ ¼)";
                winBtn.onclick = () => { overlay.style.display = 'none'; moveDirect(1); };
                const loseBtn = document.createElement('button'); loseBtn.className = "pk-lose pk-btn"; loseBtn.innerText = "æˆ‘è¼¸äº† (-1æ ¼)";
                loseBtn.onclick = () => { overlay.style.display = 'none'; moveDirect(-1); };
                optList.appendChild(winBtn); optList.appendChild(loseBtn);
            } else if(type.includes("å›åˆ°èµ·é»")) {
                overlay.style.display = 'none';
                setTimeout(() => { positions[currentPlayerIdx] = 0; updateBoard(); isMoving = false; handleLand(); }, 800);
            } else if(type.includes("å‰é€² 1")) { overlay.style.display = 'none'; moveDirect(1); }
            else if(type.includes("å¾Œé€€ 1") || type.includes("å¾Œé€€ 2")) { 
                const steps = type.includes("å¾Œé€€ 1") ? -1 : -2;
                overlay.style.display = 'none'; moveDirect(steps); 
            }
            else if(type.includes("å†éª°ä¸€æ¬¡")) { overlay.style.display = 'none'; isMoving = false; infoBox.innerText = `ğŸ ${players[currentPlayerIdx]} é¡å¤–å›åˆï¼`; }
            else { overlay.style.display = 'none'; isMoving = false; }
        }

        async function moveDirect(n) {
            isMoving = true; await new Promise(r => setTimeout(r, 600));
            positions[currentPlayerIdx] = (positions[currentPlayerIdx] + n + 20) % 20;
            updateBoard(); setTimeout(() => { handleLand(); }, 400);
        }

        function updateBoard() { 
            document.querySelectorAll('.marker-container').forEach(m => m.innerHTML = ''); 
            positions.forEach((p, i) => { 
                const s = document.createElement('span'); s.className = 'player-marker'; 
                if (i === currentPlayerIdx) s.classList.add('selected');
                s.innerText = PLAYER_ICONS[i]; 
                const container = document.getElementById(`m-${p}`);
                if(container) container.appendChild(s);
            }); 
        }
    </script>
</body>
</html>
