<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>115å¹´æ¡ƒåœ’å¸‚å‹•ç‰©ä¿è­·è™•-å°¾ç‰™å¤§å¯Œç¿</title>
    <style>
        :root {
            --primary-blue: #01579B;
            --accent-orange: #FF8C00;
            --bg-gradient: linear-gradient(180deg, #E1F5FE 0%, #B3E5FC 50%, #81D4FA 100%);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            font-family: "Microsoft JhengHei", sans-serif;
            background: var(--bg-gradient);
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* é¦–é èˆ‡è¨­å®šé  */
        #setup-page, #name-page { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .title { font-size: clamp(36px, 6vw, 80px); font-weight: bold; color: var(--primary-blue); margin-bottom: 25px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .circle-btn { width: 110px; height: 110px; border-radius: 50%; border: 6px solid var(--primary-blue); background: white; font-size: 42px; font-weight: bold; color: var(--primary-blue); cursor: pointer; transition: 0.2s; }
        .circle-btn:hover { background: var(--primary-blue); color: white; transform: scale(1.1); }
        .input-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; max-height: 50vh; overflow-y: auto; padding: 10px; }
        input { padding: 15px; font-size: 24px; border-radius: 12px; border: 3px solid var(--primary-blue); text-align: center; width: 100%; }
        .start-game-btn { padding: 18px 70px; font-size: 32px; background: #2E7D32; color: white; border-radius: 50px; border: none; cursor: pointer; font-weight: bold; }

        /* éŠæˆ²ä¸»ç•«é¢ä½ˆå±€ */
        #game-page { display: none; flex-direction: column; height: 100vh; padding: 8px; }
        
        .board-container { 
            display: grid; 
            grid-template-columns: repeat(6, 1fr); 
            grid-template-rows: repeat(6, 1fr);
            gap: 6px; 
            flex: 1; 
            min-height: 0;
        }
        
        .cell { 
            background: white; 
            border: 3.5px solid #333; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 900; 
            font-size: clamp(16px, 1.8vw, 26px);
            padding: 5px; 
            text-align: center;
            line-height: 1.2;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .center-area { 
            grid-column: 2 / 6; 
            grid-row: 2 / 6;
            background-image: url('https://raw.githubusercontent.com/JY-Chiu/html/main/bg.jpg'); 
            background-size: cover;
            background-position: center;
            border: 6px solid var(--primary-blue); 
            border-radius: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-end;
            margin: 2px;
            padding-bottom: 25px;
        }

        #info-box { 
            font-size: clamp(22px, 2.5vw, 38px); 
            background: rgba(0, 0, 0, 0.85); 
            color: #FFEB3B; 
            padding: 15px 30px; 
            border-radius: 25px; 
            border: 3px solid #FFD700; 
            text-align: center; 
            width: 85%; 
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .marker-container {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            flex-wrap: wrap;
            align-content: space-between;
            justify-content: space-between;
            padding: 3px;
            pointer-events: none;
        }

        .player-marker { 
            font-size: clamp(22px, 2.8vw, 44px);
            filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.4));
            z-index: 10;
            transition: all 0.3s;
        }

        /* ğŸš© å¼·åŒ–å¿ƒè·³ç¸®æ”¾æ•ˆæœ */
        .player-marker.selected {
            animation: markerPulse 0.8s infinite alternate cubic-bezier(0.4, 0, 0.6, 1);
            z-index: 100;
        }

        @keyframes markerPulse {
            from { 
                transform: scale(1); 
                filter: drop-shadow(0 0 5px #FFEB3B);
            }
            to { 
                transform: scale(1.8); /* æ”¾å¤§å€ç‡æé«˜ */
                filter: drop-shadow(0 0 20px #FFEB3B) drop-shadow(0 0 30px #FF8C00);
            }
        }

        /* æ§åˆ¶åˆ— */
        .controls { 
            display: flex; 
            align-items: center;
            background: white; 
            padding: 12px; 
            border-top: 5px solid var(--primary-blue); 
            gap: 15px;
        }
        
        .player-tabs { 
            display: flex; 
            gap: 10px; 
            overflow-x: auto; 
            padding-bottom: 5px;
            flex: 1;
        }

        .player-btn { 
            flex: 0 0 auto; 
            padding: 8px 15px; 
            border: 3.5px solid #ddd; 
            border-radius: 12px; 
            background: white; 
            cursor: pointer; 
            text-align: center;
            min-width: 100px;
        }
        .player-btn.active { border-color: var(--accent-orange); background: #FFF3E0; }
        .player-btn.lucky { border-color: #f44336; animation: luckyPulse 2s infinite; }
        .player-btn .icon { font-size: 32px; display: block; }
        .player-btn .name { font-size: 18px; font-weight: bold; white-space: nowrap; }

        .dice-group { display: flex; gap: 8px; }
        .dice-btn { 
            width: 60px; height: 60px; 
            background: #FF5722; color: white; 
            border: none; border-radius: 12px; 
            font-size: 32px; font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 5px 0 #BF360C; 
        }
        .dice-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #BF360C; }

        /* å½ˆçª—æ¨£å¼ï¼šä¿®æ­£ PK æ¯”è³½æŒ‰éˆ•å°ç¨± */
        #card-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center; }
        .card { width: 750px; padding: 40px; border-radius: 40px; text-align: center; border: 10px solid gold; animation: cardPop 0.4s ease-out; }
        .card.chance { background: linear-gradient(135deg, #FF9800, #E65100); color: white; }
        .card.destiny { background: linear-gradient(135deg, #9C27B0, #4A148C); color: white; }
        .card.special { background: linear-gradient(135deg, #2196F3, #1565C0); color: white; border-color: #E3F2FD; }
        .card h1 { font-size: 72px; margin-bottom: 20px; }

        .opt-container { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-top: 20px;
            width: 100%;
        }
        /* ç¢ºä¿æŒ‰éˆ•ç­‰å¯¬ */
        .pk-btn { 
            flex: 1; 
            max-width: 320px;
            padding: 25px; 
            font-size: 38px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-weight: bold; 
            border: none; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            white-space: nowrap;
        }
        .pk-win { background: #4CAF50; color: white; }
        .pk-lose { background: #F44336; color: white; }

        @keyframes cardPop { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes luckyPulse { 0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); } }
    </style>
</head>
<body>

    <div id="setup-page">
        <div class="title">ğŸ¾ 115å¹´æ¡ƒåœ’å¸‚å‹•ç‰©ä¿è­·è™• ğŸ¾<br>å°¾ç‰™å¤§å¯Œç¿</div>
        <div class="grid-container" id="count-btns"></div>
    </div>

    <div id="name-page" style="display: none;">
        <div class="title">ç¢ºèªå„çµ„åç¨±</div>
        <div class="input-grid" id="input-fields"></div>
        <button class="start-game-btn" onclick="initGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="game-page">
        <div class="board-container" id="board">
            <div class="center-area">
                <div id="info-box">ğŸ² è«‹æ“²éª°å­</div>
            </div>
        </div>
        <div class="controls">
            <div class="player-tabs" id="player-tabs"></div>
            <div class="dice-group" id="dice-group"></div>
        </div>
    </div>

    <div id="card-overlay">
        <div id="card-content" class="card">
            <h1 id="card-title">æ¨™é¡Œ</h1>
            <div id="card-body">
                <h2 id="card-desc" style="font-size: 42px;">å…§å®¹æè¿°</h2>
                <div class="opt-container" id="opt-list"></div>
            </div>
        </div>
    </div>

    <script>
        const BOARD_PATH_COORDS = [
            [1,1],[1,2],[1,3],[1,4],[1,5],[1,6], 
            [2,6],[3,6],[4,6],[5,6],             
            [6,6],[6,5],[6,4],[6,3],[6,2],[6,1], 
            [5,1],[4,1],[3,1],[2,1]              
        ];

        const CELL_THEMES = [
            ["ğŸ <br>èµ·é»&çµ‚é»", "#FFA600"], ["å†éª°ä¸€æ¬¡", "#FDDE95"], ["å‰ç¥¥è©±å¤§è²èªª", "#FDDE95"], ["ğŸ«°<br>èˆ‡é•·å®˜æ¯”å¿ƒåˆç…§", "#FDDE95"], ["å‰é€² 1 æ ¼", "#A1F999"], ["â“<br>æ©Ÿæœƒ", "#FF8C00"],
            ["æ•¬é•·å®˜æ¡Œä¸€æ¯", "#FDDE95"], ["æ”¯æ´å‰ç·š<br>ä¸‹å›åˆé•·å®˜éª°", "#FDDE95"], ["å¾Œé€€ 1 æ ¼", "#FD9E95"], 
            ["ğŸ <br>å›åˆ°èµ·é»", "#FF5252"],
            ["â˜•<br>ä¼‘æ¯ç«™", "#FF8C00"], ["éé…’ç²¾é£²æ–™*1", "#FDDE95"],
            ["å¾Œé€€ 2 æ ¼", "#FD9E95"], ["ğŸ«°<br>èˆ‡é•·å®˜æ¯”å¿ƒåˆç…§", "#FDDE95"], ["âš”ï¸<br>PKå¤§è³½", "#FDDE95"], ["ğŸŒŸ<br>å‘½é‹", "#FF8C00"], ["æ­¡æ¨‚é›¶é£ŸåŒ…*1", "#FDDE95"], ["å¾Œé€€ 1 æ ¼", "#FD9E95"],
            ["å‰é€² 1 æ ¼", "#A1F999"], ["å¡æ‹‰OK<br>ç¾å ´åˆå”±", "#FDDE95"]
        ];

        const REWARDS = {
            "â“ æ©Ÿæœƒ": ["100å…ƒç¦®åˆ¸", "éé…’ç²¾é£²æ–™", "ç¾å ´åˆå”±", "ä¸»ç®¡åŠ ç¢¼"],
            "ğŸŒŸ å‘½é‹": ["100å…ƒç¦®åˆ¸", "æ­¡æ¨‚é›¶é£ŸåŒ…", "ç¾å ´åˆå”±", "å†æŠ½ä¸€æ¬¡"]
        };

        const PLAYER_ICONS = ["ğŸ¶","ğŸ±","ğŸ­","ğŸ°","ğŸ¦Š","ğŸ¼","ğŸ¨","ğŸ¯"];
        let players = [], positions = [], luckyStatus = [], currentPlayerIdx = 0, isMoving = false;

        for(let i=1; i<=8; i++) {
            const btn = document.createElement('button');
            btn.className = 'circle-btn'; btn.innerText = i;
            btn.onclick = () => {
                document.getElementById('setup-page').style.display = 'none';
                document.getElementById('name-page').style.display = 'flex';
                const container = document.getElementById('input-fields');
                container.innerHTML = '';
                for(let j=0; j<i; j++) {
                    const input = document.createElement('input');
                    input.value = `${j+1} èª²`; input.className = 'player-name-input';
                    container.appendChild(input);
                }
            };
            document.getElementById('count-btns').appendChild(btn);
        }

        function initGame() {
            players = Array.from(document.querySelectorAll('.player-name-input')).map(inp => inp.value);
            positions = new Array(players.length).fill(0);
            luckyStatus = new Array(players.length).fill(false);
            document.getElementById('name-page').style.display = 'none';
            document.getElementById('game-page').style.display = 'flex';
            
            const board = document.getElementById('board');
            const centerArea = document.querySelector('.center-area');
            board.innerHTML = ''; board.appendChild(centerArea);

            BOARD_PATH_COORDS.forEach((coord, i) => {
                const cell = document.createElement('div');
                cell.className = 'cell'; cell.id = `cell-${i}`;
                cell.style.gridRow = coord[0]; cell.style.gridColumn = coord[1];
                cell.style.backgroundColor = CELL_THEMES[i][1];
                cell.innerHTML = `<span>${CELL_THEMES[i][0]}</span><div class="marker-container" id="m-${i}"></div>`;
                board.appendChild(cell);
            });

            const tabBox = document.getElementById('player-tabs');
            players.forEach((name, i) => {
                const btn = document.createElement('button');
                btn.className = 'player-btn'; btn.id = `p-btn-${i}`;
                btn.innerHTML = `<span class="icon">${PLAYER_ICONS[i]}</span><span class="name">${name}</span>`;
                btn.onclick = () => selectPlayer(i);
                tabBox.appendChild(btn);
            });

            for(let i=1; i<=6; i++) {
                const btn = document.createElement('button');
                btn.className = 'dice-btn'; btn.innerText = i;
                btn.onclick = () => rollDice(i);
                document.getElementById('dice-group').appendChild(btn);
            }
            updateBoard(); selectPlayer(0);
        }

        function selectPlayer(idx) { 
            if(!isMoving) { 
                currentPlayerIdx = idx; 
                document.querySelectorAll('.player-btn').forEach((b,i) => {
                    b.classList.toggle('active', i==idx);
                });
                let msg = `è¼ªåˆ°ï¼š${PLAYER_ICONS[idx]} ${players[idx]}`;
                if(luckyStatus[idx]) msg += " (ğŸ“¢ å–Šå‰ç¥¥è©±!)";
                document.getElementById('info-box').innerText = msg; 
                document.getElementById(`p-btn-${idx}`).scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                updateBoard();
            } 
        }

        async function rollDice(steps) {
            if(isMoving) return; isMoving = true;
            document.getElementById('info-box').innerText = `ğŸ² éª°å‡ºï¼š${steps} æ­¥ï¼`;
            await new Promise(r => setTimeout(r, 600));
            
            for(let i=0; i<steps; i++) { 
                let nextPos = (positions[currentPlayerIdx] + 1) % 20;
                positions[currentPlayerIdx] = nextPos; 
                updateBoard(); 
                if (nextPos === 0) {
                    document.getElementById('info-box').innerText = `ğŸ æŠµé”çµ‚é»ï¼`;
                    break;
                }
                await new Promise(r => setTimeout(r, 250)); 
            }
            handleLand();
        }

        function handleLand() {
            const pos = positions[currentPlayerIdx];
            const type = CELL_THEMES[pos][0].replace('<br>', ' ');
            const infoBox = document.getElementById('info-box');
            infoBox.innerText = `${PLAYER_ICONS[currentPlayerIdx]} æŠµé”ï¼š${type}`;

            const overlay = document.getElementById('card-overlay');
            const card = document.getElementById('card-content');
            const title = document.getElementById('card-title');
            const desc = document.getElementById('card-desc');
            const optList = document.getElementById('opt-list');

            optList.innerHTML = '';
            overlay.style.display = 'flex';

            if(type.includes("æ©Ÿæœƒ") || type.includes("å‘½é‹")) {
                const isChance = type.includes("æ©Ÿæœƒ");
                const cleanType = isChance ? "â“ æ©Ÿæœƒ" : "ğŸŒŸ å‘½é‹";
                card.className = `card ${isChance ? "chance" : "destiny"}`;
                title.innerText = cleanType;
                desc.innerText = "è«‹ç¾å ´é¸æ“‡çå‹µï¼š";
                REWARDS[cleanType].forEach(reward => {
                    const btn = document.createElement('button');
                    btn.className = "pk-btn pk-win"; btn.style.maxWidth = "100%";
                    btn.innerText = reward;
                    btn.onclick = () => { overlay.style.display = 'none'; isMoving = false; };
                    optList.appendChild(btn);
                });
            } else if(type.includes("å‰ç¥¥è©±")) {
                card.className = "card special";
                title.innerText = "ğŸ“¢ æ³¨æ„ï¼";
                desc.innerText = `å¾ç¾åœ¨èµ·ï¼Œ${players[currentPlayerIdx]} æ“²éª°å‰å¿…é ˆå¤§å–Šå‰ç¥¥è©±ï¼`;
                luckyStatus[currentPlayerIdx] = true;
                document.getElementById(`p-btn-${currentPlayerIdx}`).classList.add('lucky');
                const btn = document.createElement('button');
                btn.className = "pk-btn pk-win"; btn.style.maxWidth = "100%";
                btn.innerText = "æ–°å¹´å¿«æ¨‚ï¼";
                btn.onclick = () => { overlay.style.display = 'none'; isMoving = false; };
                optList.appendChild(btn);
            } else if(type.includes("PKå¤§è³½")) {
                card.className = "card special";
                title.innerText = "âš”ï¸ PK å¤§è³½";
                desc.innerText = "æŒ‡å®šä¸€éšŠæ¯”å¤§å°ï¼";
                const winBtn = document.createElement('button');
                winBtn.className = "pk-win pk-btn"; winBtn.innerText = "æˆ‘è´äº† (+1æ ¼)";
                winBtn.onclick = () => { overlay.style.display = 'none'; moveDirect(1); };
                const loseBtn = document.createElement('button');
                loseBtn.className = "pk-lose pk-btn"; loseBtn.innerText = "æˆ‘è¼¸äº† (-1æ ¼)";
                loseBtn.onclick = () => { overlay.style.display = 'none'; moveDirect(-1); };
                optList.appendChild(winBtn);
                optList.appendChild(loseBtn);
            } else if(type.includes("å›åˆ°èµ·é»")) {
                overlay.style.display = 'none';
                setTimeout(() => { 
                    positions[currentPlayerIdx] = 0; 
                    updateBoard(); 
                    isMoving = false; 
                    handleLand(); 
                }, 800);
            } else if(type.includes("å‰é€² 1")) { overlay.style.display = 'none'; moveDirect(1); }
            else if(type.includes("å‰é€² 2")) { overlay.style.display = 'none'; moveDirect(2); }
            else if(type.includes("å¾Œé€€ 1")) { overlay.style.display = 'none'; moveDirect(-1); }
            else if(type.includes("å¾Œé€€ 2")) { overlay.style.display = 'none'; moveDirect(-2); }
            else if(type.includes("å†éª°ä¸€æ¬¡")) {
                overlay.style.display = 'none';
                isMoving = false;
                infoBox.innerText = `ğŸ ${players[currentPlayerIdx]} é¡å¤–å›åˆï¼`;
            }
            else { 
                overlay.style.display = 'none'; 
                isMoving = false; 
            }
        }

        async function moveDirect(n) {
            isMoving = true;
            await new Promise(r => setTimeout(r, 600));
            let targetPos = (positions[currentPlayerIdx] + n + 20) % 20;
            positions[currentPlayerIdx] = targetPos; 
            updateBoard(); 
            setTimeout(() => { handleLand(); }, 400);
        }

        function updateBoard() { 
            document.querySelectorAll('.marker-container').forEach(m => m.innerHTML = ''); 
            positions.forEach((p, i) => { 
                const s = document.createElement('span'); 
                s.className = 'player-marker'; 
                if (i === currentPlayerIdx) s.classList.add('selected');
                s.innerText = PLAYER_ICONS[i]; 
                const container = document.getElementById(`m-${p}`);
                if(container) container.appendChild(s);
            }); 
        }
    </script>
</body>
</html>
